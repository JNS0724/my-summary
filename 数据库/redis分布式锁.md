# redis 分布式锁

分布式锁的关键：

1、达到互斥的要求
2、避免死锁，保证锁能释放
3、锁的性能

主要步骤：
1、用key做锁标记，value为用户标号写入redis。
2、当key不存在时写入，保证互斥。存在时则没获得锁。
3、设置过期时间，过期自动释放。
4、业务处理完后解锁

以上为redission加锁的步骤，其中一旦加锁成功，会有一个看门狗机制，自动对锁进行续期直到业务完成。

redission存在的问题主要在于主从架构有可能会因为主节点挂掉而导致锁信息丢失。对于这个问题，有redlock算法来尝试解决，对3个以上奇数个的master节点进行加锁请求，如果半数以上回复则加锁成功。（可以是N个单机节点，也可以是N个sentinel或者是N个cluster集群）