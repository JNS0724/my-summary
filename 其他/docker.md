# docker

基本实现原理：命名空间、CGroups、联合文件系统

## 命名空间

通过Linux命名空间对容器进行隔离。

Linux有两个特殊的进程：

* pid 为 1 的 /sbin/init 进程

    前者负责执行内核的一部分初始化工作和系统配置，也会创建一些类似 getty 的注册进程

* pid 为 2 的 kthreadd 进程

    负责管理和调度其他的内核进程。

容器内只有pid0和1的进程，是因为命名空间实现了进程隔离。

### 网桥模式

docker启动时会有docker0的默认网桥，并为每个容器配置虚拟网卡，所有符合条件的请求都会通过iptables转发到docker0并由网桥分发给对应的机器。

### chroot

通过改变当前系统的根目录，我们能够限制用户的权利，在新的根目录下并不能够访问旧系统根目录的结构个文件，也就建立了一个与原系统完全隔离的目录结构。

## CGroups

隔离cpu内存等资源，每一个 CGroup 都是一组被相同的标准和参数限制的进程，不同的 CGroup 之间是有层级关系的，也就是说它们之间可以从父类继承一些用于限制资源使用的标准和参数。

## 镜像

Docker 镜像其实本质就是一个压缩包